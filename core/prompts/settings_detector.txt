You are an expert at analyzing scenario descriptions and extracting environmental settings.

Analyze the following user query and detect:
1. Weather conditions (rain, clear, cloudy, wet, etc.)
2. Map type (urban, rural, highway, intersection)
3. Time of day (noon, sunset, night, dawn)

User Query:
{user_query}

Available Weather Options:
- ClearNoon, CloudyNoon, WetNoon, WetCloudyNoon, SoftRainNoon, MidRainyNoon, HardRainNoon
- ClearSunset, CloudySunset, WetSunset, WetCloudySunset, SoftRainSunset, MidRainSunset, HardRainSunset

Map Type to CARLA Map Mapping:
- urban/city/intersection/crossroad → Town05 (default, has many intersections)
- urban/downtown → Town03 or Town10HD (dense urban areas)
- rural/countryside/village → Town07 (rural environment)
- highway/freeway/motorway → Town04 or Town06 (highway scenarios)

Detection Rules:

1. Weather keywords:
   - "rainy", "rain", "raining" with intensity:
     * "light rain", "soft rain", "drizzle" → SoftRainNoon/SoftRainSunset
     * "rain", "rainy" (no modifier) → MidRainyNoon/MidRainSunset
     * "heavy rain", "hard rain", "downpour" → HardRainNoon/HardRainSunset
   - "clear", "sunny", "bright" → ClearNoon/ClearSunset
   - "cloudy", "overcast", "gray" → CloudyNoon/CloudySunset
   - "wet", "damp" (without active rain) → WetNoon/WetSunset

2. Time keywords:
   - "noon", "midday", "daytime", "afternoon" → Noon
   - "sunset", "dusk", "evening", "twilight" → Sunset
   - Default to Noon if not specified

3. Map keywords:
   - "intersection", "crossroad", "junction", "traffic light", "turning" → Town05
   - "urban", "city", "downtown", "metropolitan" → Town05 (or Town03/Town10HD for very dense)
   - "rural", "countryside", "village", "farmland" → Town07
   - "highway", "freeway", "motorway", "expressway" → Town04

4. Confidence scoring:
   - 1.0: Explicit mention (e.g., "rainy weather", "at intersection")
   - 0.8: Strong implication (e.g., "wet road conditions" implies recent rain)
   - 0.6: Moderate implication (e.g., "turning left" implies intersection)
   - 0.4: Weak implication or context-based guess
   - 0.0: No information detected

Important:
- If no specific setting is detected, use null for that field
- Combine time of day with weather (e.g., "rainy" + "noon" = "SoftRainNoon")
- Provide clear reasoning for your detection
- Be conservative with confidence scores

Output Format (JSON only, no markdown, no explanations outside JSON):
{{
  "weather": "SoftRainNoon",
  "map_type": "rural",
  "suggested_map": "Town07",
  "time_of_day": "noon",
  "confidence": 0.9,
  "reasoning": "Query mentions 'rainy weather' and 'rural area at noon'"
}}

Now analyze the query and output JSON only:

